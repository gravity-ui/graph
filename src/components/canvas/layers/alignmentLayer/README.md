# Alignment Lines Layer

Слой для отображения линий выравнивания при перетаскивании блоков с использованием магнитного прилипания к границам.

## Описание

`AlignmentLinesLayer` - это визуальный слой, который показывает пунктирные линии выравнивания когда пользователь перетаскивает блоки. Линии появляются когда блок приближается к границам других блоков и показывают точки выравнивания.

## Особенности

- ✅ Интеграция с `MagneticBorderModifier`
- ✅ Автоматическое обнаружение блоков в области видимости
- ✅ Настраиваемый стиль линий (цвет, толщина, пунктир)
- ✅ Поддержка всех четырех направлений выравнивания
- ✅ Динамическое добавление/удаление модификаторов через события
- ✅ Оптимизированная отрисовка только во время перетаскивания

## Использование

### Базовое использование

```typescript
import { Graph } from "@gravity-ui/graph";
import { AlignmentLinesLayer } from "@gravity-ui/graph";

const graph = new Graph(container, {
  layers: [
    // ... другие слои
    [AlignmentLinesLayer, {}], // Базовая конфигурация
  ],
});
```

### Расширенная конфигурация

```typescript
[
  AlignmentLinesLayer,
  {
    magneticBorderConfig: {
      magnetismDistance: "auto", // или число в пикселях
      enabledBorders: ["top", "right", "bottom", "left"],
      targets: [Block], // типы компонентов для выравнивания
    },
    lineStyle: {
      color: "#007AFF",
      width: 1,
      dashPattern: [5, 5],
    },
  },
]
```

## Конфигурация

### AlignmentLinesLayerProps

| Свойство | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `magneticBorderConfig` | `Partial<MagneticBorderModifierConfig>` | - | Конфигурация магнитного прилипания |
| `lineStyle` | `LineStyleConfig` | - | Стиль отображения линий |

### MagneticBorderModifierConfig

| Свойство | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `magnetismDistance` | `number \| "auto"` | `"auto"` | Расстояние магнетизма в пикселях или "auto" для всего viewport |
| `enabledBorders` | `Array<"top" \| "right" \| "bottom" \| "left">` | `["top", "right", "bottom", "left"]` | Включенные границы для выравнивания |
| `targets` | `Constructor<GraphComponent>[]` | `[Block]` | Типы компонентов для поиска |
| `resolveBounds` | `(element) => Bounds \| null` | - | Функция получения границ элемента |
| `filter` | `(element) => boolean` | - | Фильтр элементов для выравнивания |

### LineStyleConfig

| Свойство | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| `color` | `string` | `"#007AFF"` | Цвет линий |
| `width` | `number` | `1` | Толщина линий в пикселях |
| `dashPattern` | `number[]` | `[5, 5]` | Паттерн пунктирной линии |

## Примеры

### Только горизонтальное выравнивание

```typescript
[
  AlignmentLinesLayer,
  {
    magneticBorderConfig: {
      enabledBorders: ["top", "bottom"],
    },
    lineStyle: {
      color: "#FF3B30",
      width: 2,
    },
  },
]
```

### Ограниченное расстояние магнетизма

```typescript
[
  AlignmentLinesLayer,
  {
    magneticBorderConfig: {
      magnetismDistance: 50, // 50 пикселей
    },
    lineStyle: {
      color: "#34C759",
      dashPattern: [3, 3],
    },
  },
]
```

### Кастомная фильтрация элементов

```typescript
[
  AlignmentLinesLayer,
  {
    magneticBorderConfig: {
      filter: (element) => {
        // Выравнивание только с видимыми блоками определенного типа
        return element instanceof Block && 
               element.isVisible() && 
               element.getState().type === "process";
      },
    },
  },
]
```

## Архитектура

Слой реализует интерфейс `IDragMiddleware` и использует систему событий:

1. **drag-start** - добавляет модификатор и активирует визуализацию
2. **drag-update** - обновляет линии выравнивания на основе текущей позиции
3. **drag-end** - убирает модификатор и скрывает линии

### Алгоритм работы

1. При начале перетаскивания блока добавляется `MagneticBorderModifier`
2. Модификатор анализирует ближайшие элементы и находит точки выравнивания
3. Данные о выравнивании передаются через контекст drag события
4. Слой извлекает информацию о границах и строит линии выравнивания
5. Линии отрисовываются на canvas с настроенным стилем
6. При завершении перетаскивания все очищается

## Производительность

- Отрисовка происходит только во время активного перетаскивания
- Используется кеширование вычислений в `MagneticBorderModifier`
- Линии рисуются с учетом текущего масштаба камеры
- Автоматическая очистка при завершении операции

## Интеграция

Слой полностью интегрирован с системой событий графа и может использоваться совместно с другими слоями и модификаторами без конфликтов.