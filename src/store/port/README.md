# Port System

## üéØ –ú–æ—Ç–∏–≤–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Ä—Ç–æ–≤ —Ä–µ—à–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≥—Ä–∞—Ñ–æ–≤ - **–∂–µ—Å—Ç–∫—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**.

### –ü—Ä–æ–±–ª–µ–º–∞ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã

**–î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤:**
```typescript
// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
// 1. –°–Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞—Ç—å—Å—è –±–ª–æ–∫–∏
// 2. –ü–æ—Ç–æ–º –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞—Ç—å—Å—è —è–∫–æ—Ä—è
// 3. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤—è–∑–∏

// –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–ª–æ–∫–∞ - –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É
const connection = new Connection({
  sourceBlockId: "block1", // –ë–ª–æ–∫ –º–æ–∂–µ—Ç –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å!
  targetBlockId: "block2"  // –Ø–∫–æ—Ä—å –º–æ–∂–µ—Ç –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å!
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, race conditions, –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

### –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç—ã

**–° —Å–∏—Å—Ç–µ–º–æ–π –ø–æ—Ä—Ç–æ–≤:**
```typescript
// ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ø–æ—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
// 1. –°–≤—è–∑—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ—Ä—Ç
// 2. –ï—Å–ª–∏ –ø–æ—Ä—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// 3. –ü–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã

const port = graph.rootStore.portsList.getOrCreatePort("block1_input", component);
// –ü–æ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –±–ª–æ–∫ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. **–ü–æ—Ä—Ç—ã - —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**

–ü–æ—Ä—Ç –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É, –∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—É—é —Ç–æ—á–∫—É –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ**, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –ª—é–±—ã–º –æ–±—ä–µ–∫—Ç–æ–º:

```typescript
interface Port {
  id: string;           // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  x: number;           // –ü–æ–∑–∏—Ü–∏—è X
  y: number;           // –ü–æ–∑–∏—Ü–∏—è Y
  component?: any;     // –°–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  lookup: boolean;     // –§–ª–∞–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
}
```

### 2. **–ü–æ—Ä—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏**

–ö–∞–∂–¥—ã–π –ø–æ—Ä—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

```typescript
// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω
port.setSelected(true);

// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥—Å–≤–µ—á–µ–Ω
port.setHighlighted(true);

// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ —Å—Ç–∏–ª–∏
port.setStyle({ color: "red", width: 2 });
```

### 3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é (Lazy Creation)**

–ü–æ—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã:

```typescript
// –ü–æ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
const port = portsList.getOrCreatePort("new_port", component);

// –ï—Å–ª–∏ –ø–æ—Ä—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
const samePort = portsList.getOrCreatePort("new_port", component);
// samePort === port (true)
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–æ—Ä—Ç–∞

### –°–æ–∑–¥–∞–Ω–∏–µ
```typescript
// 1. –ó–∞–ø—Ä–æ—Å –ø–æ—Ä—Ç–∞
const port = portsList.getOrCreatePort("port_id", component);

// 2. –ï—Å–ª–∏ –ø–æ—Ä—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// 3. –ü–æ—Ä—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (0, 0)
// 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ lookup = true
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```typescript
// –ü–æ—Ä—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥–æ—Ç–æ–≤
port.setPoint(x, y);
port.setComponent(component);
port.setLookup(false); // –¢–µ–ø–µ—Ä—å —ç—Ç–æ "–Ω–∞—Å—Ç–æ—è—â–∏–π" –ø–æ—Ä—Ç
```

### –£–¥–∞–ª–µ–Ω–∏–µ
```typescript
// –ü–æ—Ä—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è
portsList.deletePort("port_id");
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
- –°–≤—è–∑–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ
- –ë–ª–æ–∫–∏ –∏ —è–∫–æ—Ä—è –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∂–¥–∞—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 2. **–ì–∏–±–∫–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**
- –ü–æ—Ä—Ç—ã –º–æ–≥—É—Ç —Å–≤—è–∑—ã–≤–∞—Ç—å –ª—é–±—ã–µ –æ–±—ä–µ–∫—Ç—ã, –Ω–µ —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–∏
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–≤—è–∑–µ–π

### 3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ü–æ—Ä—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã

### 4. **–û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
- –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ú–µ–Ω—å—à–µ —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ª—é–±—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
```typescript
// –°–≤—è–∑—å –º–µ–∂–¥—É –±–ª–æ–∫–æ–º –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
const blockPort = portsList.getOrCreatePort("block1_output", block);
const customPort = portsList.getOrCreatePort("custom_element", customComponent);

// –°–≤—è–∑—å –º–µ–∂–¥—É –¥–≤—É–º—è —è–∫–æ—Ä—è–º–∏
const sourcePort = portsList.getOrCreatePort("block1_anchor_input", block);
const targetPort = portsList.getOrCreatePort("block2_anchor_output", block);
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏
```typescript
// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ–∑–∏—Ü–∏—é
port.setPoint(newX, newY);

// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω
port.setEnabled(false);

// –ü–æ—Ä—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
port.setConnectionRules({ maxConnections: 3 });
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
```typescript
// –ü–æ—Ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
port.$state.subscribe((state) => {
  console.log("–ü–æ—Ä—Ç –æ–±–Ω–æ–≤–ª–µ–Ω:", state);
});
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
```typescript
// –ü–æ—Ä—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
component.onUnmount(() => {
  portsList.deletePorts(component.getPortIds());
});
```

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Ä—Ç–æ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∂–µ—Å—Ç–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –≥–∏–±–∫—É—é —Å–∏—Å—Ç–µ–º—É, –≥–¥–µ:

- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ**
- **–°–≤—è–∑–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–ª–æ–∫–æ–≤**
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
- **–ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –∏ –æ—Ç–ª–∞–∂–∏–≤–∞–µ–º—ã–º**

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç `@gravity-ui/graph` –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –≥–∏–±–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∞–º–∏.
